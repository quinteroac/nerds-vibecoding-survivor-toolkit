[
  {"testCaseId": "TC-001-01", "status": "passed", "evidence": "define-refactor-plan.test.ts rejects when currentPhase is prototype; define-refactor-plan.ts throws when current_phase !== 'refactor'.", "notes": ""},
  {"testCaseId": "TC-001-02", "status": "passed", "evidence": "define-refactor-plan.test.ts rejects when refactorPlanStatus is approved; handler throws when refactor_plan.status !== 'pending'.", "notes": ""},
  {"testCaseId": "TC-001-03", "status": "passed", "evidence": "define-refactor-plan.test.ts loads skill 'plan-refactor' and prompt contains 'current_iteration' and '000013'; loadSkillFn(projectRoot, 'plan-refactor') and buildPrompt(skillBody, { current_iteration }).", "notes": ""},
  {"testCaseId": "TC-001-04", "status": "passed", "evidence": "define-refactor-plan.test.ts expects invocation.interactive === true; invokeAgentFn called with interactive: true in define-refactor-plan.ts.", "notes": ""},
  {"testCaseId": "TC-001-05", "status": "passed", "evidence": "define-refactor-plan.test.ts asserts refactor_plan.status === 'pending_approval' and refactor_plan.file === 'it_000013_refactor-plan.md' after agent exitCode 0.", "notes": ""},
  {"testCaseId": "TC-001-06", "status": "passed", "evidence": "define-refactor-plan.test.ts asserts state.last_updated and state.updated_by === 'nvst:define-refactor-plan'; define-refactor-plan.ts calls writeState(projectRoot, state) once on success.", "notes": ""},
  {"testCaseId": "TC-001-07", "status": "passed", "evidence": "cli.ts: command === 'define', subcommand === 'refactor-plan' dispatches to runDefineRefactorPlan({ provider }); define-refactor-plan.test.ts checks cli.ts contains runDefineRefactorPlan and refactor-plan.", "notes": ""},
  {"testCaseId": "TC-001-08", "status": "passed", "evidence": "Grep on src/commands/define-refactor-plan.ts: zero occurrences of process.exit(.", "notes": ""},
  {"testCaseId": "TC-001-09", "status": "failed", "evidence": ".agents/skills/plan-refactor/SKILL.md contains only TBD placeholders; missing ## Refactor Items, ### RI-NNN: <Title>, **Description:**, **Rationale:** structure.", "notes": "FR-9 requires the skill to include the stated structure; file has Objective/Inputs/Outputs but no Refactor Items section or subsection format."},
  {"testCaseId": "TC-002-01", "status": "passed", "evidence": "refine-refactor-plan.test.ts requires status pending_approval and rejects when status is approved; handler throws when refactor_plan.status !== 'pending_approval'.", "notes": ""},
  {"testCaseId": "TC-002-02", "status": "passed", "evidence": "refine-refactor-plan.test.ts rejects when refactor_plan.file is null; handler throws 'refactor.refactor_plan.file is missing.'.", "notes": ""},
  {"testCaseId": "TC-002-03", "status": "passed", "evidence": "refine-refactor-plan.test.ts rejects when plan file does not exist on disk; handler throws 'file not found at'.", "notes": ""},
  {"testCaseId": "TC-002-04", "status": "passed", "evidence": "refine-refactor-plan.test.ts expects loadedSkill === 'refine-refactor-plan'; loadSkillFn(projectRoot, 'refine-refactor-plan') resolves to .agents/skills/refine-refactor-plan/SKILL.md.", "notes": ""},
  {"testCaseId": "TC-002-05", "status": "passed", "evidence": "refine-refactor-plan.test.ts asserts prompt contains current_iteration, refactor_plan_file, refactor_plan_content and plan file content; refine-refactor-plan.ts builds context with current_iteration, refactor_plan_file, refactor_plan_content.", "notes": ""},
  {"testCaseId": "TC-002-06", "status": "passed", "evidence": "refine-refactor-plan.ts sets context.mode only when challenge is true; without --challenge, context has no mode key.", "notes": ""},
  {"testCaseId": "TC-002-07", "status": "passed", "evidence": "refine-refactor-plan.test.ts 'passes mode=challenger when challenge mode is enabled' asserts invocationPrompt contains '### mode' and 'challenger'; context.mode = 'challenger' when challenge is true.", "notes": ""},
  {"testCaseId": "TC-002-08", "status": "passed", "evidence": "refine-refactor-plan.test.ts compares stateBefore and stateAfter JSON; state unchanged after runRefineRefactorPlan (status remains pending_approval).", "notes": ""},
  {"testCaseId": "TC-002-09", "status": "passed", "evidence": "cli.ts: refine refactor-plan branch sets challenge = postAgentArgs.includes('--challenge') and calls runRefineRefactorPlan({ provider, challenge }); refine-refactor-plan.test.ts checks cli.ts for runRefineRefactorPlan and --challenge.", "notes": ""},
  {"testCaseId": "TC-002-10", "status": "passed", "evidence": "Grep on src/commands/refine-refactor-plan.ts: zero occurrences of process.exit(.", "notes": ""},
  {"testCaseId": "TC-002-11", "status": "passed", "evidence": ".agents/skills/refine-refactor-plan/SKILL.md exists; content includes 'Editor mode' and 'Challenger mode' (edit and challenge instructions).", "notes": ""},
  {"testCaseId": "TC-003-01", "status": "passed", "evidence": "approve-refactor-plan.test.ts requires status pending_approval and rejects when status is pending; handler throws when refactor_plan.status !== 'pending_approval'.", "notes": ""},
  {"testCaseId": "TC-003-02", "status": "passed", "evidence": "approve-refactor-plan.test.ts rejects when refactor_plan.file is null; handler throws 'refactor.refactor_plan.file is missing.'.", "notes": ""},
  {"testCaseId": "TC-003-03", "status": "passed", "evidence": "approve-refactor-plan.test.ts rejects when plan file does not exist; handler throws 'file not found at'.", "notes": ""},
  {"testCaseId": "TC-003-04", "status": "passed", "evidence": "approve-refactor-plan.test.ts validates RefactorPrdSchema.safeParse(parsedPayload) success and refactorItems with id (RI-NNN), title, description, rationale; tmpl_refactor-prd.ts defines RefactorItemSchema with those fields.", "notes": ""},
  {"testCaseId": "TC-003-05", "status": "passed", "evidence": "RefactorPrdSchema uses z.object with required id, title, description, rationale (z.string().min(1) or regex); safeParse returns success: false for missing fields.", "notes": ""},
  {"testCaseId": "TC-003-06", "status": "passed", "evidence": "RefactorPrdSchema id: z.string().regex(/^RI-\\d{3}$/); rejects RI-1, R-001, empty string.", "notes": ""},
  {"testCaseId": "TC-003-07", "status": "passed", "evidence": "write-json.ts SCHEMA_REGISTRY has 'refactor-prd': RefactorPrdSchema; schema lookup does not throw 'schema not found'.", "notes": ""},
  {"testCaseId": "TC-003-08", "status": "passed", "evidence": "approve-refactor-plan.test.ts 'prints an error and keeps refactor plan pending_approval when write-json fails' asserts process.exitCode === 1 and state unchanged (status pending_approval, updated_by 'seed').", "notes": ""},
  {"testCaseId": "TC-003-09", "status": "passed", "evidence": "approve-refactor-plan.test.ts asserts refactor_plan.status === 'approved' and state persisted after write-json success; handler sets status to approved and calls writeState.", "notes": ""},
  {"testCaseId": "TC-003-10", "status": "passed", "evidence": "approve-refactor-plan.test.ts asserts state.last_updated and state.updated_by === 'nvst:approve-refactor-plan' on success.", "notes": ""},
  {"testCaseId": "TC-003-11", "status": "passed", "evidence": "cli.ts: approve refactor-plan dispatches to runApproveRefactorPlan(); approve-refactor-plan.test.ts checks cli.ts contains runApproveRefactorPlan and refactor-plan.", "notes": ""},
  {"testCaseId": "TC-003-12", "status": "passed", "evidence": "Grep on src/commands/approve-refactor-plan.ts: zero occurrences of process.exit(.", "notes": ""}
]
