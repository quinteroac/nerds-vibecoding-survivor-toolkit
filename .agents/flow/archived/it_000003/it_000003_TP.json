{
  "scope": [],
  "automatedTests": [
    "TC-US001-01: Verify `create test-plan` is registered in `src/cli.ts` (integration) -> Command is recognized by the CLI router.",
    "TC-US001-02: Verify `create-test-plan` loads correct skill file (unit) -> `loadSkill` is called with `.agents/skills/create-test-plan/SKILL.md`.",
    "TC-US001-03: Verify agent invocation with iteration context (integration) -> Agent is called with PRD and project context.",
    "TC-US001-04: Verify output file creation (integration) -> File `.agents/flow/it_000003_test-plan.md` is created after agent completion.",
    "TC-US001-05: Verify `--force` flag for overwriting existing file (integration) -> Command fails without `--force` if file exists; succeeds with it.",
    "TC-US001-06: Verify `state.json` updates after creation (unit) -> `test_plan.status` is `\"pending_approval\"`, `test_plan.file` is set, `last_updated` and `updated_by` are updated.",
    "TC-US001-07: Verify precondition: `project_context.status === \"created\"` (unit) -> Command fails if project context is not in \"created\" status.",
    "TC-US001-08: Verify FR-1: command implementation in `src/commands/create-test-plan.ts` (unit) -> Handler file exists and exports `runCreateTestPlan`.",
    "TC-US001-09: Verify behavior when agent invocation fails (integration) -> Command does not create the output file or update state when `invokeAgent` returns a non-zero exit code or empty stdout.",
    "TC-US002-01: Verify `refine test-plan` is registered in `src/cli.ts` (integration) -> Command is recognized by the CLI router.",
    "TC-US002-02: Verify `refine-test-plan` loads correct skill file (unit) -> `loadSkill` is called with `.agents/skills/refine-test-plan/SKILL.md`.",
    "TC-US002-03: Verify current test plan is passed as context (integration) -> Agent prompt includes the content of the existing test plan.",
    "TC-US002-04: Verify state is not updated during refinement (unit) -> `state.json` remains unchanged after `refine` command.",
    "TC-US002-05: Verify precondition: `test_plan.status === \"pending_approval\"` (unit) -> Command fails if test plan is not in \"pending_approval\" status.",
    "TC-US002-06: Verify FR-2: command implementation in `src/commands/refine-test-plan.ts` (unit) -> Handler file exists and exports `runRefineTestPlan`.",
    "TC-US003-01: Verify `--challenge` flag sets `mode: \"challenger\"` (integration) -> Context passed to `buildPrompt` contains `mode: \"challenger\"`.",
    "TC-US003-02: Verify challenger mode does not update state (unit) -> `state.json` remains unchanged.",
    "TC-US003-03: Verify `--challenge` requires `test_plan.status === \"pending_approval\"` (unit) -> Command fails if test plan is not in \"pending_approval\" status when `--challenge` flag is used.",
    "TC-US003-04: Verify test plan content is passed as context in challenger mode (integration) -> Agent prompt includes the content of the existing test plan when invoked with `--challenge`.",
    "TC-US003-05: Verify `refine-test-plan` skill is loaded for challenge mode (unit) -> `loadSkill` is called with `.agents/skills/refine-test-plan/SKILL.md` when `--challenge` flag is used.",
    "TC-US004-01: Verify `approve test-plan` is registered in `src/cli.ts` (integration) -> Command is recognized by the CLI router.",
    "TC-US004-02: Verify precondition: `test_plan.status === \"pending_approval\"` (unit) -> Command fails if test plan is not in \"pending_approval\" status.",
    "TC-US004-03: Verify state update to `\"created\"` on approval (unit) -> `test_plan.status` becomes `\"created\"`.",
    "TC-US004-04: Verify JSON test plan generation (`it_000003_TP.json`) (integration) -> JSON file is created and follows the test plan schema.",
    "TC-US004-05: Verify `state.json` updates for JSON generation (unit) -> `tp_generation.status` is `\"created\"`, `tp_generation.file` is set.",
    "TC-US004-06: Verify FR-3: command implementation in `src/commands/approve-test-plan.ts` (unit) -> Handler file exists and exports `runApproveTestPlan`.",
    "TC-US004-07: Verify approve fails or warns when test plan markdown is missing required sections (integration) -> `parseTestPlan` produces an error or warning when input markdown lacks required sections (`## Scope`, `## Automated tests`, etc.) rather than silently returning empty arrays.",
    "TC-US004-08: Verify approve fails gracefully when test plan file is missing from disk (integration) -> Command produces a clear error message when `test_plan.file` references a nonexistent file, without updating state.",
    "TC-US005-01: Verify skill file exists and has YAML frontmatter (unit) -> `.agents/skills/create-test-plan/SKILL.md` exists and is valid.",
    "TC-US005-02: Verify FR-6: skill instructions prioritize automation (unit) -> Prompt includes clear instructions to automate functional requirements (FR-N).",
    "TC-US005-03: Verify skill instructions for structured markdown output (unit) -> Prompt specifies grouping by user story and mandatory columns.",
    "TC-US006-01: Verify skill file exists and has YAML frontmatter (unit) -> `.agents/skills/refine-test-plan/SKILL.md` exists and is valid.",
    "TC-US006-02: Verify editor and challenger modes in skill content (unit) -> Skill defines distinct instructions for default and `--challenge` modes.",
    "TC-GEN-01: Verify Zod schema validation for all state changes (unit) -> All `writeState` calls pass validation.",
    "TC-GEN-02: Verify `buildPrompt` output contains correct context sections (unit) -> Assembled prompt includes `### current_iteration` with the iteration value, `### test_plan_file` with the filename, and (for refine) `### test_plan_content` with the file body. For challenge mode, assert `### mode` contains `\"challenger\"`.",
    "TC-GEN-03: Verify naming convention for iteration artifacts (unit) -> Files use `it_000003_` prefix and correct extensions.",
    "TC-GEN-04: Verify `test_plan.status` transitions: pending → pending_approval → created (integration) -> `test_plan.status` is `\"pending\"` initially, becomes `\"pending_approval\"` after create, and becomes `\"created\"` after approve.",
    "TC-GEN-05: Verify `tp_generation.status` transitions: pending → created on approve (integration) -> `tp_generation.status` is `\"pending\"` initially and becomes `\"created\"` after approve; `tp_generation.file` is set to `\"it_000003_TP.json\"`.",
    "TC-GEN-06: Verify CLI rejects missing `--agent` flag with usage message (integration) -> Commands that require `--agent` exit with code 1 and display help when the flag is omitted.",
    "TC-GEN-07: Verify CLI rejects invalid `--agent` provider value (integration) -> An unsupported provider name (e.g., `--agent unknown`) produces a clear error message and exits with code 1.",
    "TC-GEN-08: Verify CLI typechecking and linting (integration) -> `bun x tsc --noEmit` and any lint checks pass without errors."
  ],
  "exploratoryManualTests": [],
  "environmentAndData": []
}
