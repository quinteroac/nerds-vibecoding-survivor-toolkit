{
  "overallStatus": "pending",
  "scope": [
    "Behaviour of the new command `bun nvst approve prototype`: CLI registration, state validation, guardrail enforcement, git operations (stage, commit, push), optional `gh pr create`, and state update.",
    "All functional requirements FR-1 through FR-8 and user stories US-001 through US-004.",
    "Exit code semantics: success (0), failure (exitCode = 1), and the guarantee that `process.exit()` is never called.",
    "Schema and typecheck: `state.json` structure and TypeScript strict mode remain valid after any code changes."
  ],
  "environmentData": [
    "Runtime: Bun v1+; tests run via `bun test` (Bun built-in runner).",
    "Isolated git repo for integration tests: temporary directory with `git init`, optional `git remote add`, and controllable working tree state (clean vs dirty).",
    "Optional `gh` CLI: tests that depend on `gh` must either mock subprocess/exit code or be skipped when `gh` is not installed; tests for \"gh not available\" use a mocked or overridden check.",
    "Fixtures: `.agents/state.json` with configurable `current_phase`, `phases.prototype.prototype_approved`, and `flow_guardrail`; copies or in-memory state used so real project state is not mutated by tests.",
    "Test location: `src/commands/approve-prototype.test.ts` for unit/command tests; `tests/` for integration/e2e if needed.",
    "---",
    "## User Story: US-001 - Commit pending changes"
  ],
  "automatedTests": [
    {
      "id": "TC-US001-01",
      "description": "CLI routes `approve prototype` to `runApprovePrototype` in `src/commands/approve-prototype.ts`",
      "status": "pending",
      "correlatedRequirements": [
        "US-001",
        "FR-1"
      ]
    },
    {
      "id": "TC-US001-02",
      "description": "With dirty working tree, command runs `git add -A` and creates a commit with message `feat: approve prototype it_<iteration>` using iteration from state",
      "status": "pending",
      "correlatedRequirements": [
        "US-001",
        "FR-3"
      ]
    },
    {
      "id": "TC-US001-03",
      "description": "With clean working tree, command prints an informative message and does not create an empty commit",
      "status": "pending",
      "correlatedRequirements": [
        "US-001",
        "FR-3"
      ]
    },
    {
      "id": "TC-US001-04",
      "description": "When commit fails due to pre-commit hook, error message includes `Pre-commit hook failed:\\n` plus hook output",
      "status": "pending",
      "correlatedRequirements": [
        "US-001",
        "FR-3"
      ]
    },
    {
      "id": "TC-US001-05",
      "description": "Typecheck passes for the codebase (e.g. `bun run tsc --noEmit` or equivalent)",
      "status": "pending",
      "correlatedRequirements": [
        "US-001"
      ]
    },
    {
      "id": "TC-US002-01",
      "description": "After a successful commit, command runs `git push -u origin <current-branch>`",
      "status": "pending",
      "correlatedRequirements": [
        "US-002",
        "FR-4"
      ]
    },
    {
      "id": "TC-US002-02",
      "description": "When push fails (e.g. no remote), command throws a descriptive error, sets process.exitCode to 1, and does not update state.json",
      "status": "pending",
      "correlatedRequirements": [
        "US-002",
        "FR-4",
        "FR-7"
      ]
    },
    {
      "id": "TC-US002-03",
      "description": "Typecheck passes for the codebase",
      "status": "pending",
      "correlatedRequirements": [
        "US-002"
      ]
    },
    {
      "id": "TC-US003-01",
      "description": "When `gh` is available, command runs `gh pr create` with title `feat: prototype it_<iteration>` and body referencing iteration",
      "status": "pending",
      "correlatedRequirements": [
        "US-003",
        "FR-5"
      ]
    },
    {
      "id": "TC-US003-02",
      "description": "When `gh` is not available, command prints a clear skip message to stdout and exits with code 0",
      "status": "pending",
      "correlatedRequirements": [
        "US-003",
        "FR-5"
      ]
    },
    {
      "id": "TC-US003-03",
      "description": "When `gh pr create` fails (e.g. PR already exists), error is surfaced as non-fatal warning and state.json is still updated",
      "status": "pending",
      "correlatedRequirements": [
        "US-003",
        "FR-5",
        "FR-6"
      ]
    },
    {
      "id": "TC-US003-04",
      "description": "Typecheck passes for the codebase",
      "status": "pending",
      "correlatedRequirements": [
        "US-003"
      ]
    },
    {
      "id": "TC-US004-01",
      "description": "After successful commit and push, state.json is updated: `phases.prototype.prototype_approved` is true and `last_updated` is refreshed",
      "status": "pending",
      "correlatedRequirements": [
        "US-004",
        "FR-6"
      ]
    },
    {
      "id": "TC-US004-02",
      "description": "When `prototype_approved` is already true, command throws a descriptive error and exits with code 1",
      "status": "pending",
      "correlatedRequirements": [
        "US-004",
        "FR-2",
        "FR-7"
      ]
    },
    {
      "id": "TC-US004-03",
      "description": "When current phase is not \"prototype\", assertGuardrail blocks execution with a descriptive message",
      "status": "pending",
      "correlatedRequirements": [
        "US-004",
        "FR-8"
      ]
    },
    {
      "id": "TC-US004-04",
      "description": "Handler calls assertGuardrail at the start with correct context",
      "status": "pending",
      "correlatedRequirements": [
        "FR-8"
      ]
    },
    {
      "id": "TC-US004-05",
      "description": "All error paths set process.exitCode = 1 and never call process.exit()",
      "status": "pending",
      "correlatedRequirements": [
        "FR-7"
      ]
    },
    {
      "id": "TC-US004-06",
      "description": "Typecheck passes for the codebase",
      "status": "pending",
      "correlatedRequirements": [
        "US-004"
      ]
    }
  ],
  "exploratoryManualTests": []
}
